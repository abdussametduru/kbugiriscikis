<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kullanıcı Bazlı Giriş-Çıkış</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
h1 { text-align:center; color:#333; margin-bottom:20px; }
.kullanici-container { width:90%; max-width:500px; margin:15px auto; padding:10px; border:1px solid #ccc; border-radius:10px; background:#fff; }
.kullanici-container h2 { text-align:center; margin:5px 0; }
button { width:45%; padding:12px; margin:5px 2%; font-size:16px; border:none; border-radius:8px; cursor:pointer; }
button:disabled { background:#ccc; color:#666; cursor:not-allowed; }
.girisBtn { background-color:#4CAF50; color:white; }
.cikisBtn { background-color:#f44336; color:white; }
table { width:90%; max-width:500px; margin:20px auto; border-collapse: collapse; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background-color:#eee; }
.renk-yesil { background-color:#c8e6c9; }  /* Girişler */
.renk-kirmizi { background-color:#ffcdd2; } /* Çıkışlar */
#calismaSuresi { width:90%; max-width:500px; margin:20px auto; padding:10px; background:#e0e0e0; border-radius:8px; text-align:center; font-weight:bold; }
@media(max-width:480px){ button { font-size:14px; padding:10px; } table { font-size:14px; } }
</style>
</head>
<body>
<h1>Kullanıcı Bazlı Giriş-Çıkış</h1>

<div id="butonContainer"></div>
<div id="tabloContainer"></div>
<div id="calismaSuresi"></div>

<script>
const kullanicilar = ['sametduru','ibrahimarslan','fatihünal'];
let loglar = JSON.parse(localStorage.getItem('loglar')||'[]');

function baslangicLog(){
    if(loglar.length===0){
        const now = new Date();
        const tarih = now.toLocaleDateString();
        kullanicilar.forEach(k=>{
            loglar.push({kullanici:k, tarih, girisSaati:'-', cikisSaati:'-', girisRenk:false, cikisRenk:false});
        });
        localStorage.setItem('loglar',JSON.stringify(loglar));
    }
}
baslangicLog();

function logGoster(){
    const container = document.getElementById('tabloContainer');
    container.innerHTML='';
    const calismaDiv = document.getElementById('calismaSuresi');
    calismaDiv.innerHTML='';

    kullanicilar.forEach(k=>{
        const userLogs = loglar.filter(l=>l.kullanici===k);
        const table = document.createElement('table');
        table.innerHTML = `<thead><tr><th>Tarih</th><th>Kullanıcı</th><th>Giriş</th><th>Çıkış</th></tr></thead>`;
        const tbody = document.createElement('tbody');

        userLogs.forEach(l=>{
            const tr = document.createElement('tr');
            const girisTd = document.createElement('td');
            girisTd.textContent = l.girisSaati;
            if(l.girisRenk) girisTd.className='renk-yesil';
            const cikisTd = document.createElement('td');
            cikisTd.textContent = l.cikisSaati;
            if(l.cikisRenk) cikisTd.className='renk-kirmizi';
            tr.innerHTML = `<td>${l.tarih}</td><td>${k}</td>`;
            tr.appendChild(girisTd);
            tr.appendChild(cikisTd);
            tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        container.appendChild(table);
    });
}

const butonContainer = document.getElementById('butonContainer');
kullanicilar.forEach(k=>{
    const div = document.createElement('div');
    div.className='kullanici-container';
    div.innerHTML = `<h2>${k}</h2>
    <button class="girisBtn">Giriş Yapıldı</button>
    <button class="cikisBtn">Çıkış Yapıldı</button>`;
    butonContainer.appendChild(div);

    const girisBtn = div.querySelector('.girisBtn');
    const cikisBtn = div.querySelector('.cikisBtn');

    girisBtn.addEventListener('click', ()=>{
        const kayit = loglar.find(l=>l.kullanici===k);
        if(kayit.girisRenk){ alert('Zaten giriş yaptınız!'); return; }
        const now = new Date();
        kayit.girisSaati = now.toLocaleTimeString();
        kayit.girisRenk = true;
        localStorage.setItem('loglar',JSON.stringify(loglar));
        logGoster();
    });

    cikisBtn.addEventListener('click', ()=>{
        const kayit = loglar.find(l=>l.kullanici===k);
        if(!kayit.girisRenk){ alert('Giriş yapmadan çıkış yapamazsınız!'); return; }
        if(kayit.cikisRenk){ alert('Zaten çıkış yaptınız!'); return; }
        const now = new Date();
        kayit.cikisSaati = now.toLocaleTimeString();
        kayit.cikisRenk = true;
        localStorage.setItem('loglar',JSON.stringify(loglar));
        logGoster();

        const tumCikisYapti = loglar.every(l=>l.cikisRenk);
        if(tumCikisYapti){
            const girisler = loglar.map(l=>l.girisSaati.split(':').map(Number));
            const cikislar = loglar.map(l=>l.cikisSaati.split(':').map(Number));
            const ilkGiris = new Date(0,0,0,girisler[0][0],girisler[0][1],girisler[0][2]||0);
            const sonCikis = new Date(0,0,0,cikislar[cikislar.length-1][0],cikislar[cikislar.length-1][1],cikislar[cikislar.length-1][2]||0);
            let fark = (sonCikis-ilkGiris)/1000;
            if(fark<0) fark=0;
            const h = Math.floor(fark/3600);
            const m = Math.floor((fark%3600)/60);
            const s = Math.floor(fark%60);
            document.getElementById('calismaSuresi').textContent = `Toplam Çalışma Süresi: ${h} saat ${m} dakika ${s} saniye`;

            // Yayın sürümü: 4 saat sonra sayfa yenileniyor
            setTimeout(()=>{
                localStorage.removeItem('loglar');
                location.reload();
            }, 4*60*60*1000); // 4 saat = 14400000 ms
        }
    });
});

logGoster();
</script>
</body>
</html>
